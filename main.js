(()=>{"use strict";var e={baseURL:"https://nomoreparties.co/v1/wff-cohort-7",headers:{authorization:"37c27805-4486-40c8-98d8-f35c7d710efc","Content-type":"application/json"}};function t(e,t){return e.ok?e.json():Promise.reject("".concat(t,": ").concat(e.status))}function n(n){return fetch("".concat(e.baseURL,"/cards/likes/").concat(n),{method:"PUT",headers:e.headers}).then((function(e){return t(e,"Произошла ошибка при лайке карточки")}))}function r(n){return fetch("".concat(e.baseURL,"/cards/likes/").concat(n),{method:"DELETE",headers:e.headers}).then((function(e){return t(e,"Произошла ошибка при дизлайке карточки")}))}var o=document.querySelector("#card-template").content;function c(e,t,n,r,c){var a=o.querySelector(".card").cloneNode(!0),i=a.querySelector(".card__image");i.src=e.link,i.alt="Фотография ".concat(e.name),i.addEventListener("click",n),a.querySelector(".card__title").textContent=e.name;var l=a.querySelector(".card__like-button"),s=a.querySelector(".card__likes-count");u(s,e.likes.length),l.addEventListener("click",(function(t){r(t,e._id,s)})),e.likes.some((function(e){return e._id===t}))&&l.classList.add("card__like-button_is-active");var d=a.querySelector(".card__delete-button");return e.owner._id!==t?d.style.display="none":d.addEventListener("click",(function(){return c(e._id,a)})),a}function a(e,t,o){(e.target.classList.contains("card__like-button_is-active")?r:n)(t).then((function(t){u(o,t.likes.length),e.target.classList.toggle("card__like-button_is-active")})).catch((function(e){return console.log(e)}))}function u(e,t){e.textContent=t}function i(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",s)}function l(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",s)}function s(e){"Escape"===e.key&&l(document.querySelector(".popup_is-opened"))}function d(e,t,n){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),r.classList.remove(n.errorClass),r.textContent=""}function f(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n.inactiveButtonClass),t.disabled=!1):(t.classList.add(n.inactiveButtonClass),t.disabled=!0)}function p(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);e.reset(),f(n,r,t),n.forEach((function(n){return d(e,n,t)}))}function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var _,y,v,h={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_is-inactive",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_is-active"},S=document.querySelector(".places__list"),b=document.querySelectorAll(".popup"),L=document.querySelector(".popup_type_edit"),q=document.querySelector(".popup_type_avatar"),E=document.querySelector(".profile__edit-button"),g=document.querySelector(".popup_type_new-card"),k=document.querySelector(".profile__add-button"),C=document.querySelector(".popup_type_image"),A=C.querySelector(".popup__image"),x=C.querySelector(".popup__caption"),w=document.querySelector(".profile__title"),U=document.querySelector(".profile__description"),R=document.querySelector(".profile__image"),j=document.forms["edit-profile"],O=j.elements.name,I=j.elements.description,T=document.forms["edit-avatar"],B=T.elements.link,D=document.forms["new-place"],P=D.elements["place-name"],M=D.elements.link,N=document.querySelector(".popup_type_delete"),J=N.querySelector(".popup__button"),H={cardId:null,cardElement:null};function V(e,t){t.textContent=e?"Сохранение...":"Сохранить"}function z(e){w.textContent=e.name,U.textContent=e.about,R.style.backgroundImage="url(".concat(e.avatar,")")}function $(e){var t=e.target,n=t.closest(".card").querySelector(".card__title");i(C),A.src=t.src,A.alt=t.alt,x.textContent=n.textContent}function F(e,t){i(N),H.cardId=e,H.cardElement=t}E.addEventListener("click",(function(){var e,t;e=w.textContent,t=U.textContent,p(j,h),O.value=e,I.value=t,i(L)})),R.addEventListener("click",(function(){return i(q)})),j.addEventListener("submit",(function(n){n.preventDefault();var r,o=j.querySelector(".popup__button"),c={name:O.value,about:I.value};V(!0,o),(r=c,fetch("".concat(e.baseURL,"/users/me"),{method:"PATCH",headers:e.headers,body:JSON.stringify(r)}).then((function(e){return t(e,"Произошла ошибка при обновлении информации о пользователе")}))).then((function(e){z(e),l(L)})).catch((function(e){return console.log(e)})).finally((function(){return V(!1,o)}))})),T.addEventListener("submit",(function(n){n.preventDefault();var r,o=T.querySelector(".popup__button");V(!0,o),(r=B.value,fetch("".concat(e.baseURL,"/users/me/avatar"),{method:"PATCH",headers:e.headers,body:JSON.stringify({avatar:r})}).then((function(e){return t(e,"Произошла ошибка при обновлении аватарки пользователя")}))).then((function(e){z(e),l(q),T.reset()})).catch((function(e){return console.log(e)})).finally((function(){return V(!1,o)}))})),k.addEventListener("click",(function(){return i(g)})),D.addEventListener("submit",(function(n){n.preventDefault();var r,o=D.querySelector(".popup__button"),u={name:P.value,link:M.value};V(!0,o),(r=u,fetch("".concat(e.baseURL,"/cards"),{method:"POST",headers:e.headers,body:JSON.stringify(r)}).then((function(e){return t(e,"Произошла ошибка при добавлении новой карточки")}))).then((function(e){S.prepend(c(e,_,$,a,F)),l(g),p(D,h)})).catch((function(e){return console.log(e)})).finally((function(){return V(!1,o)}))})),J.addEventListener("click",(function(){return function(n){var r;(r=n.cardId,fetch("".concat(e.baseURL,"/cards/").concat(r),{method:"DELETE",headers:e.headers}).then((function(e){return t(e,"Произошла ошибка при удалении карточки пользователя")}))).then((function(){l(N),n.cardElement.remove()})).catch((function(e){return console.log(e)}))}(H)})),b.forEach((function(e){e.addEventListener("mousedown",(function(t){(t.target.classList.contains("popup__close")||t.target.classList.contains("popup_is-opened"))&&l(e)}))})),y=fetch("".concat(e.baseURL,"/users/me"),{headers:e.headers}).then((function(e){return t(e,"Произошла ошибка при запросе информации о пользователе:")})),v=fetch("".concat(e.baseURL,"/cards"),{headers:e.headers}).then((function(e){return t(e,"Произошла ошибка при запросе списка карточек")})),Promise.all([y,v]).then((function(e){var t,n,r=(n=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,c,a,u=[],i=!0,l=!1;try{if(c=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;i=!1}else for(;!(i=(r=c.call(n)).done)&&(u.push(r.value),u.length!==t);i=!0);}catch(e){l=!0,o=e}finally{try{if(!i&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw o}}return u}}(t,n)||function(e,t){if(e){if("string"==typeof e)return m(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?m(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=r[0],u=r[1];_=o._id,z(o),function(e){e.forEach((function(e){S.append(c(e,_,$,a,F))}))}(u)})).catch((function(e){return console.log(e)})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);f(n,r,t),n.forEach((function(o){o.addEventListener("input",(function(){!function(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?d(e,t,n):function(e,t,n,r){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add(r.inputErrorClass),o.textContent=n,o.classList.add(r.errorClass)}(e,t,t.validationMessage,n)}(e,o,t),f(n,r,t)}))}))}(t,e)}))}(h)})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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SXlGLENBQWtCM0YsRUFBYUUsRUFDakMsR0FDRixDQzJJQTBGLENBQWlCMUYsRSIsInNvdXJjZXMiOlsid2VicGFjazovL21lc3RvLXByb2plY3QtZmYvLi9zcmMvc2NyaXB0cy9hcGkuanMiLCJ3ZWJwYWNrOi8vbWVzdG8tcHJvamVjdC1mZi8uL3NyYy9zY3JpcHRzL2NhcmQuanMiLCJ3ZWJwYWNrOi8vbWVzdG8tcHJvamVjdC1mZi8uL3NyYy9zY3JpcHRzL21vZGFsLmpzIiwid2VicGFjazovL21lc3RvLXByb2plY3QtZmYvLi9zcmMvc2NyaXB0cy92YWxpZGF0aW9uLmpzIiwid2VicGFjazovL21lc3RvLXByb2plY3QtZmYvLi9zcmMvaW5kZXguanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgYXBpQ29uZmlnID0ge1xyXG4gIGJhc2VVUkw6IFwiaHR0cHM6Ly9ub21vcmVwYXJ0aWVzLmNvL3YxL3dmZi1jb2hvcnQtN1wiLFxyXG4gIGhlYWRlcnM6IHtcclxuICAgIGF1dGhvcml6YXRpb246IFwiMzdjMjc4MDUtNDQ4Ni00MGM4LTk4ZDgtZjM1YzdkNzEwZWZjXCIsXHJcbiAgICBcIkNvbnRlbnQtdHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcclxuICB9LFxyXG59O1xyXG5cclxuZnVuY3Rpb24gaGFuZGxlUmVzcG9uc2UocmVzcG9uc2UsIGVycm9yTWVzc2FnZSkge1xyXG4gIGlmIChyZXNwb25zZS5vaykge1xyXG4gICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKTtcclxuICB9XHJcbiAgcmV0dXJuIFByb21pc2UucmVqZWN0KGAke2Vycm9yTWVzc2FnZX06ICR7cmVzcG9uc2Uuc3RhdHVzfWApO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZ2V0VXNlclByb2ZpbGUoKSB7XHJcbiAgcmV0dXJuIGZldGNoKGAke2FwaUNvbmZpZy5iYXNlVVJMfS91c2Vycy9tZWAsIHtcclxuICAgIGhlYWRlcnM6IGFwaUNvbmZpZy5oZWFkZXJzLFxyXG4gIH0pLnRoZW4oKHJlcykgPT5cclxuICAgIGhhbmRsZVJlc3BvbnNlKFxyXG4gICAgICByZXMsXHJcbiAgICAgIFwi0J/RgNC+0LjQt9C+0YjQu9CwINC+0YjQuNCx0LrQsCDQv9GA0Lgg0LfQsNC/0YDQvtGB0LUg0LjQvdGE0L7RgNC80LDRhtC40Lgg0L4g0L/QvtC70YzQt9C+0LLQsNGC0LXQu9C1OlwiXHJcbiAgICApXHJcbiAgKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGdldENhcmRMaXN0KCkge1xyXG4gIHJldHVybiBmZXRjaChgJHthcGlDb25maWcuYmFzZVVSTH0vY2FyZHNgLCB7XHJcbiAgICBoZWFkZXJzOiBhcGlDb25maWcuaGVhZGVycyxcclxuICB9KS50aGVuKChyZXMpID0+XHJcbiAgICBoYW5kbGVSZXNwb25zZShyZXMsIFwi0J/RgNC+0LjQt9C+0YjQu9CwINC+0YjQuNCx0LrQsCDQv9GA0Lgg0LfQsNC/0YDQvtGB0LUg0YHQv9C40YHQutCwINC60LDRgNGC0L7Rh9C10LpcIilcclxuICApO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gcGF0Y2hVc2VyUHJvZmlsZShwcm9maWxlRGF0YSkge1xyXG4gIHJldHVybiBmZXRjaChgJHthcGlDb25maWcuYmFzZVVSTH0vdXNlcnMvbWVgLCB7XHJcbiAgICBtZXRob2Q6IFwiUEFUQ0hcIixcclxuICAgIGhlYWRlcnM6IGFwaUNvbmZpZy5oZWFkZXJzLFxyXG4gICAgYm9keTogSlNPTi5zdHJpbmdpZnkocHJvZmlsZURhdGEpLFxyXG4gIH0pLnRoZW4oKHJlcykgPT5cclxuICAgIGhhbmRsZVJlc3BvbnNlKFxyXG4gICAgICByZXMsXHJcbiAgICAgIFwi0J/RgNC+0LjQt9C+0YjQu9CwINC+0YjQuNCx0LrQsCDQv9GA0Lgg0L7QsdC90L7QstC70LXQvdC40Lgg0LjQvdGE0L7RgNC80LDRhtC40Lgg0L4g0L/QvtC70YzQt9C+0LLQsNGC0LXQu9C1XCJcclxuICAgIClcclxuICApO1xyXG59XHJcblxyXG4vKiDQntC/0YbQuNC+0L3QsNC70YzQvdCw0Y8g0L/RgNC+0LLQtdGA0LrQsCwg0YfRgtC+INGO0LfQtdGAINGD0LrQsNC30LDQuyDRgdGB0YvQu9C60YMg0L3QsCDQutCw0YDRgtC40L3QutGDINC/0YDQuCDQstGL0LHQvtGA0LUg0LDQstCw0YLQsNGA0LrQuCDQv9C+0LrQsCDQvdC1INGA0LXQsNC70LjQt9C+0LLQsNC90LAgLVxyXG7QvdC10LrQvtGC0L7RgNGL0LUg0YDQtdGB0YPRgNGB0Ysg0LHQu9C+0LrQuNGA0YPRjtGCINC30LDQv9GA0L7RgSDQuNC3LdC30LAg0L3QsNGB0YLRgNC+0LXQuiBDT1JTLCDQv9C+0LrQsCDQvdC1INC/0YDQuNC00YPQvNCw0Lsg0LrQsNC6INGN0YLQviDQv9C+0L/RgNCw0LLQuNGC0YwqL1xyXG5cclxuLyogZXhwb3J0IGZ1bmN0aW9uIGlzSW1hZ2VVUkwoVVJMKSB7XHJcbiAgbGV0IGlzSW1hZ2U7XHJcbiAgcmV0dXJuIGZldGNoKFVSTCwge1xyXG4gICAgbWV0aG9kOiBcIkhFQURcIixcclxuICB9KVxyXG4gICAgLnRoZW4oKHJlcykgPT4ge1xyXG4gICAgICBjb25zb2xlLmxvZyhyZXMpO1xyXG4gICAgICBjb25zb2xlLmxvZyhyZXMuaGVhZGVycy5nZXQoXCJDb250ZW50LXR5cGVcIikpO1xyXG4gICAgICBpc0ltYWdlID0gcmVzLmhlYWRlcnMuZ2V0KFwiQ29udGVudC10eXBlXCIpLmluY2x1ZGVzKFwiaW1hZ2VcIik7XHJcbiAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoaXNJbWFnZSk7XHJcbiAgICB9KVxyXG4gICAgLmNhdGNoKChlcnIpID0+IGNvbnNvbGUubG9nKGVycikpO1xyXG59ICovXHJcblxyXG5leHBvcnQgZnVuY3Rpb24gcGF0Y2hVc2VyQXZhdGFyKGF2YXRhclVSTCkge1xyXG4gIHJldHVybiBmZXRjaChgJHthcGlDb25maWcuYmFzZVVSTH0vdXNlcnMvbWUvYXZhdGFyYCwge1xyXG4gICAgbWV0aG9kOiBcIlBBVENIXCIsXHJcbiAgICBoZWFkZXJzOiBhcGlDb25maWcuaGVhZGVycyxcclxuICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcclxuICAgICAgYXZhdGFyOiBhdmF0YXJVUkwsXHJcbiAgICB9KSxcclxuICB9KS50aGVuKChyZXMpID0+XHJcbiAgICBoYW5kbGVSZXNwb25zZShyZXMsIFwi0J/RgNC+0LjQt9C+0YjQu9CwINC+0YjQuNCx0LrQsCDQv9GA0Lgg0L7QsdC90L7QstC70LXQvdC40Lgg0LDQstCw0YLQsNGA0LrQuCDQv9C+0LvRjNC30L7QstCw0YLQtdC70Y9cIilcclxuICApO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gcG9zdE5ld0NhcmQoY2FyZCkge1xyXG4gIHJldHVybiBmZXRjaChgJHthcGlDb25maWcuYmFzZVVSTH0vY2FyZHNgLCB7XHJcbiAgICBtZXRob2Q6IFwiUE9TVFwiLFxyXG4gICAgaGVhZGVyczogYXBpQ29uZmlnLmhlYWRlcnMsXHJcbiAgICBib2R5OiBKU09OLnN0cmluZ2lmeShjYXJkKSxcclxuICB9KS50aGVuKChyZXMpID0+XHJcbiAgICBoYW5kbGVSZXNwb25zZShyZXMsIFwi0J/RgNC+0LjQt9C+0YjQu9CwINC+0YjQuNCx0LrQsCDQv9GA0Lgg0LTQvtCx0LDQstC70LXQvdC40Lgg0L3QvtCy0L7QuSDQutCw0YDRgtC+0YfQutC4XCIpXHJcbiAgKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGRlbGV0ZUNhcmQoY2FyZElkKSB7XHJcbiAgcmV0dXJuIGZldGNoKGAke2FwaUNvbmZpZy5iYXNlVVJMfS9jYXJkcy8ke2NhcmRJZH1gLCB7XHJcbiAgICBtZXRob2Q6IFwiREVMRVRFXCIsXHJcbiAgICBoZWFkZXJzOiBhcGlDb25maWcuaGVhZGVycyxcclxuICB9KS50aGVuKChyZXMpID0+XHJcbiAgICBoYW5kbGVSZXNwb25zZShyZXMsIFwi0J/RgNC+0LjQt9C+0YjQu9CwINC+0YjQuNCx0LrQsCDQv9GA0Lgg0YPQtNCw0LvQtdC90LjQuCDQutCw0YDRgtC+0YfQutC4INC/0L7Qu9GM0LfQvtCy0LDRgtC10LvRj1wiKVxyXG4gICk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBwdXRDYXJkTGlrZShjYXJkSWQpIHtcclxuICByZXR1cm4gZmV0Y2goYCR7YXBpQ29uZmlnLmJhc2VVUkx9L2NhcmRzL2xpa2VzLyR7Y2FyZElkfWAsIHtcclxuICAgIG1ldGhvZDogXCJQVVRcIixcclxuICAgIGhlYWRlcnM6IGFwaUNvbmZpZy5oZWFkZXJzLFxyXG4gIH0pLnRoZW4oKHJlcykgPT4gaGFuZGxlUmVzcG9uc2UocmVzLCBcItCf0YDQvtC40LfQvtGI0LvQsCDQvtGI0LjQsdC60LAg0L/RgNC4INC70LDQudC60LUg0LrQsNGA0YLQvtGH0LrQuFwiKSk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBkZWxldGVDYXJkTGlrZShjYXJkSWQpIHtcclxuICByZXR1cm4gZmV0Y2goYCR7YXBpQ29uZmlnLmJhc2VVUkx9L2NhcmRzL2xpa2VzLyR7Y2FyZElkfWAsIHtcclxuICAgIG1ldGhvZDogXCJERUxFVEVcIixcclxuICAgIGhlYWRlcnM6IGFwaUNvbmZpZy5oZWFkZXJzLFxyXG4gIH0pLnRoZW4oKHJlcykgPT5cclxuICAgIGhhbmRsZVJlc3BvbnNlKHJlcywgXCLQn9GA0L7QuNC30L7RiNC70LAg0L7RiNC40LHQutCwINC/0YDQuCDQtNC40LfQu9Cw0LnQutC1INC60LDRgNGC0L7Rh9C60LhcIilcclxuICApO1xyXG59XHJcbiIsImltcG9ydCB7IHB1dENhcmRMaWtlLCBkZWxldGVDYXJkTGlrZSB9IGZyb20gXCIuL2FwaS5qc1wiO1xyXG5cclxuY29uc3QgY2FyZFRlbXBsYXRlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNjYXJkLXRlbXBsYXRlXCIpLmNvbnRlbnQ7XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlQ2FyZChcclxuICBjYXJkLFxyXG4gIHVzZXJJZCxcclxuICBpbWFnZUNsaWNrSGFuZGxlcixcclxuICBsaWtlQnV0dG9uQ2xpY2tIYW5kbGVyLFxyXG4gIGRlbGV0ZUJ1dHRvbkNsaWNrSGFuZGxlclxyXG4pIHtcclxuICBjb25zdCBjYXJkRWxlbWVudCA9IGNhcmRUZW1wbGF0ZS5xdWVyeVNlbGVjdG9yKFwiLmNhcmRcIikuY2xvbmVOb2RlKHRydWUpO1xyXG5cclxuICBjb25zdCBjYXJkSW1hZ2UgPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2ltYWdlXCIpO1xyXG4gIGNhcmRJbWFnZS5zcmMgPSBjYXJkLmxpbms7XHJcbiAgY2FyZEltYWdlLmFsdCA9IGDQpNC+0YLQvtCz0YDQsNGE0LjRjyAke2NhcmQubmFtZX1gO1xyXG4gIGNhcmRJbWFnZS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgaW1hZ2VDbGlja0hhbmRsZXIpO1xyXG5cclxuICBjb25zdCBjYXJkVGl0bGUgPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX3RpdGxlXCIpO1xyXG4gIGNhcmRUaXRsZS50ZXh0Q29udGVudCA9IGNhcmQubmFtZTtcclxuXHJcbiAgY29uc3QgbGlrZUJ1dHRvbiA9IGNhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fbGlrZS1idXR0b25cIik7XHJcbiAgY29uc3QgbGlrZXNDb3VudCA9IGNhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fbGlrZXMtY291bnRcIik7XHJcbiAgcmVuZGVyTGlrZXNDb3VudChsaWtlc0NvdW50LCBjYXJkLmxpa2VzLmxlbmd0aCk7XHJcbiAgbGlrZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGV2dCkgPT4ge1xyXG4gICAgbGlrZUJ1dHRvbkNsaWNrSGFuZGxlcihldnQsIGNhcmQuX2lkLCBsaWtlc0NvdW50KTtcclxuICB9KTtcclxuXHJcbiAgaWYgKGNhcmQubGlrZXMuc29tZSgobGlrZSkgPT4gbGlrZS5faWQgPT09IHVzZXJJZCkpIHtcclxuICAgIGxpa2VCdXR0b24uY2xhc3NMaXN0LmFkZChcImNhcmRfX2xpa2UtYnV0dG9uX2lzLWFjdGl2ZVwiKTtcclxuICB9XHJcblxyXG4gIGNvbnN0IGRlbGV0ZUJ1dHRvbiA9IGNhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fZGVsZXRlLWJ1dHRvblwiKTtcclxuICBpZiAoY2FyZC5vd25lci5faWQgIT09IHVzZXJJZCkge1xyXG4gICAgZGVsZXRlQnV0dG9uLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcclxuICB9IGVsc2Uge1xyXG4gICAgZGVsZXRlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PlxyXG4gICAgICBkZWxldGVCdXR0b25DbGlja0hhbmRsZXIoY2FyZC5faWQsIGNhcmRFbGVtZW50KVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIHJldHVybiBjYXJkRWxlbWVudDtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGhhbmRsZUxpa2VCdXR0b25DbGljayhldnQsIGNhcmRJZCwgbGlrZXNDb3VudEVsZW1lbnQpIHtcclxuICBjb25zdCBsaWtlTWV0aG9kID0gaXNDYXJkTGlrZWQoZXZ0LnRhcmdldCkgPyBkZWxldGVDYXJkTGlrZSA6IHB1dENhcmRMaWtlO1xyXG4gIGxpa2VNZXRob2QoY2FyZElkKVxyXG4gICAgLnRoZW4oKHJlcykgPT4ge1xyXG4gICAgICByZW5kZXJMaWtlc0NvdW50KGxpa2VzQ291bnRFbGVtZW50LCByZXMubGlrZXMubGVuZ3RoKTtcclxuICAgICAgZXZ0LnRhcmdldC5jbGFzc0xpc3QudG9nZ2xlKFwiY2FyZF9fbGlrZS1idXR0b25faXMtYWN0aXZlXCIpO1xyXG4gICAgfSlcclxuICAgIC5jYXRjaCgoZXJyKSA9PiBjb25zb2xlLmxvZyhlcnIpKTtcclxufVxyXG5cclxuZnVuY3Rpb24gaXNDYXJkTGlrZWQoYnV0dG9uRWxlbWVudCkge1xyXG4gIHJldHVybiBidXR0b25FbGVtZW50LmNsYXNzTGlzdC5jb250YWlucyhcImNhcmRfX2xpa2UtYnV0dG9uX2lzLWFjdGl2ZVwiKTtcclxufVxyXG5cclxuZnVuY3Rpb24gcmVuZGVyTGlrZXNDb3VudChsaWtlc0NvdW50RWxlbWVudCwgbGlrZXNDb3VudCkge1xyXG4gIGxpa2VzQ291bnRFbGVtZW50LnRleHRDb250ZW50ID0gbGlrZXNDb3VudDtcclxufVxyXG4iLCJleHBvcnQgZnVuY3Rpb24gb3Blbk1vZGFsKHBvcHVwRWxlbWVudCkge1xyXG4gIHBvcHVwRWxlbWVudC5jbGFzc0xpc3QuYWRkKFwicG9wdXBfaXMtb3BlbmVkXCIpO1xyXG4gIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIGNsb3NlUG9wdXBPbkVzY0tleWRvd24pO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gY2xvc2VNb2RhbChwb3B1cEVsZW1lbnQpIHtcclxuICBwb3B1cEVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShcInBvcHVwX2lzLW9wZW5lZFwiKTtcclxuICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCBjbG9zZVBvcHVwT25Fc2NLZXlkb3duKTtcclxufVxyXG5cclxuZnVuY3Rpb24gY2xvc2VQb3B1cE9uRXNjS2V5ZG93bihldnQpIHtcclxuICBpZiAoZXZ0LmtleSA9PT0gXCJFc2NhcGVcIikge1xyXG4gICAgY29uc3Qgb3BlbmVkUG9wdXAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwX2lzLW9wZW5lZFwiKTtcclxuICAgIGNsb3NlTW9kYWwob3BlbmVkUG9wdXApO1xyXG4gIH1cclxufVxyXG4iLCJmdW5jdGlvbiBzaG93SW5wdXRFcnJvcihcclxuICBmb3JtRWxlbWVudCxcclxuICBpbnB1dEVsZW1lbnQsXHJcbiAgZXJyb3JNZXNzYWdlLFxyXG4gIHZhbGlkYXRpb25Db25maWdcclxuKSB7XHJcbiAgY29uc3QgZXJyb3JFbGVtZW50ID0gZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihgLiR7aW5wdXRFbGVtZW50LmlkfS1lcnJvcmApO1xyXG4gIGlucHV0RWxlbWVudC5jbGFzc0xpc3QuYWRkKHZhbGlkYXRpb25Db25maWcuaW5wdXRFcnJvckNsYXNzKTtcclxuICBlcnJvckVsZW1lbnQudGV4dENvbnRlbnQgPSBlcnJvck1lc3NhZ2U7XHJcbiAgZXJyb3JFbGVtZW50LmNsYXNzTGlzdC5hZGQodmFsaWRhdGlvbkNvbmZpZy5lcnJvckNsYXNzKTtcclxufVxyXG5cclxuZnVuY3Rpb24gaGlkZUlucHV0RXJyb3IoZm9ybUVsZW1lbnQsIGlucHV0RWxlbWVudCwgdmFsaWRhdGlvbkNvbmZpZykge1xyXG4gIGNvbnN0IGVycm9yRWxlbWVudCA9IGZvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoYC4ke2lucHV0RWxlbWVudC5pZH0tZXJyb3JgKTtcclxuICBpbnB1dEVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSh2YWxpZGF0aW9uQ29uZmlnLmlucHV0RXJyb3JDbGFzcyk7XHJcbiAgZXJyb3JFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUodmFsaWRhdGlvbkNvbmZpZy5lcnJvckNsYXNzKTtcclxuICBlcnJvckVsZW1lbnQudGV4dENvbnRlbnQgPSBcIlwiO1xyXG59XHJcblxyXG5mdW5jdGlvbiBjaGVja0lucHV0VmFsaWRpdHkoZm9ybUVsZW1lbnQsIGlucHV0RWxlbWVudCwgdmFsaWRhdGlvbkNvbmZpZykge1xyXG4gIGlmIChpbnB1dEVsZW1lbnQudmFsaWRpdHkucGF0dGVybk1pc21hdGNoKSB7XHJcbiAgICBpbnB1dEVsZW1lbnQuc2V0Q3VzdG9tVmFsaWRpdHkoaW5wdXRFbGVtZW50LmRhdGFzZXQuZXJyb3JNZXNzYWdlKTtcclxuICB9IGVsc2Uge1xyXG4gICAgaW5wdXRFbGVtZW50LnNldEN1c3RvbVZhbGlkaXR5KFwiXCIpO1xyXG4gIH1cclxuXHJcbiAgaWYgKCFpbnB1dEVsZW1lbnQudmFsaWRpdHkudmFsaWQpIHtcclxuICAgIHNob3dJbnB1dEVycm9yKFxyXG4gICAgICBmb3JtRWxlbWVudCxcclxuICAgICAgaW5wdXRFbGVtZW50LFxyXG4gICAgICBpbnB1dEVsZW1lbnQudmFsaWRhdGlvbk1lc3NhZ2UsXHJcbiAgICAgIHZhbGlkYXRpb25Db25maWdcclxuICAgICk7XHJcbiAgfSBlbHNlIHtcclxuICAgIGhpZGVJbnB1dEVycm9yKGZvcm1FbGVtZW50LCBpbnB1dEVsZW1lbnQsIHZhbGlkYXRpb25Db25maWcpO1xyXG4gIH1cclxufVxyXG5cclxuZnVuY3Rpb24gaGFzSW52YWxpZElucHV0KGlucHV0TGlzdCkge1xyXG4gIHJldHVybiBpbnB1dExpc3Quc29tZSgoaW5wdXRFbGVtZW50KSA9PiAhaW5wdXRFbGVtZW50LnZhbGlkaXR5LnZhbGlkKTtcclxufVxyXG5cclxuZnVuY3Rpb24gdG9nZ2xlQnV0dG9uU3RhdGUoaW5wdXRMaXN0LCBidXR0b25FbGVtZW50LCB2YWxpZGF0aW9uQ29uZmlnKSB7XHJcbiAgaWYgKGhhc0ludmFsaWRJbnB1dChpbnB1dExpc3QpKSB7XHJcbiAgICBidXR0b25FbGVtZW50LmNsYXNzTGlzdC5hZGQodmFsaWRhdGlvbkNvbmZpZy5pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcclxuICAgIGJ1dHRvbkVsZW1lbnQuZGlzYWJsZWQgPSB0cnVlO1xyXG4gIH0gZWxzZSB7XHJcbiAgICBidXR0b25FbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUodmFsaWRhdGlvbkNvbmZpZy5pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcclxuICAgIGJ1dHRvbkVsZW1lbnQuZGlzYWJsZWQgPSBmYWxzZTtcclxuICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHNldEV2ZW50TGlzdGVuZXJzKGZvcm1FbGVtZW50LCB2YWxpZGF0aW9uQ29uZmlnKSB7XHJcbiAgY29uc3QgaW5wdXRMaXN0ID0gQXJyYXkuZnJvbShcclxuICAgIGZvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwodmFsaWRhdGlvbkNvbmZpZy5pbnB1dFNlbGVjdG9yKVxyXG4gICk7XHJcbiAgY29uc3QgYnV0dG9uRWxlbWVudCA9IGZvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXHJcbiAgICB2YWxpZGF0aW9uQ29uZmlnLnN1Ym1pdEJ1dHRvblNlbGVjdG9yXHJcbiAgKTtcclxuICB0b2dnbGVCdXR0b25TdGF0ZShpbnB1dExpc3QsIGJ1dHRvbkVsZW1lbnQsIHZhbGlkYXRpb25Db25maWcpO1xyXG5cclxuICBpbnB1dExpc3QuZm9yRWFjaCgoaW5wdXRFbGVtZW50KSA9PiB7XHJcbiAgICBpbnB1dEVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsICgpID0+IHtcclxuICAgICAgY2hlY2tJbnB1dFZhbGlkaXR5KGZvcm1FbGVtZW50LCBpbnB1dEVsZW1lbnQsIHZhbGlkYXRpb25Db25maWcpO1xyXG4gICAgICB0b2dnbGVCdXR0b25TdGF0ZShpbnB1dExpc3QsIGJ1dHRvbkVsZW1lbnQsIHZhbGlkYXRpb25Db25maWcpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBlbmFibGVWYWxpZGF0aW9uKHZhbGlkYXRpb25Db25maWcpIHtcclxuICBjb25zdCBmb3JtTGlzdCA9IEFycmF5LmZyb20oXHJcbiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKHZhbGlkYXRpb25Db25maWcuZm9ybVNlbGVjdG9yKVxyXG4gICk7XHJcbiAgZm9ybUxpc3QuZm9yRWFjaCgoZm9ybUVsZW1lbnQpID0+IHtcclxuICAgIGZvcm1FbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgKGV2dCkgPT4ge1xyXG4gICAgICBldnQucHJldmVudERlZmF1bHQoKTtcclxuICAgIH0pO1xyXG4gICAgc2V0RXZlbnRMaXN0ZW5lcnMoZm9ybUVsZW1lbnQsIHZhbGlkYXRpb25Db25maWcpO1xyXG4gIH0pO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gY2xlYXJWYWxpZGF0aW9uKGZvcm1FbGVtZW50LCB2YWxpZGF0aW9uQ29uZmlnKSB7XHJcbiAgY29uc3QgaW5wdXRMaXN0ID0gQXJyYXkuZnJvbShcclxuICAgIGZvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwodmFsaWRhdGlvbkNvbmZpZy5pbnB1dFNlbGVjdG9yKVxyXG4gICk7XHJcbiAgY29uc3QgYnV0dG9uRWxlbWVudCA9IGZvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXHJcbiAgICB2YWxpZGF0aW9uQ29uZmlnLnN1Ym1pdEJ1dHRvblNlbGVjdG9yXHJcbiAgKTtcclxuICBmb3JtRWxlbWVudC5yZXNldCgpO1xyXG4gIHRvZ2dsZUJ1dHRvblN0YXRlKGlucHV0TGlzdCwgYnV0dG9uRWxlbWVudCwgdmFsaWRhdGlvbkNvbmZpZyk7XHJcbiAgaW5wdXRMaXN0LmZvckVhY2goKGlucHV0RWxlbWVudCkgPT5cclxuICAgIGhpZGVJbnB1dEVycm9yKGZvcm1FbGVtZW50LCBpbnB1dEVsZW1lbnQsIHZhbGlkYXRpb25Db25maWcpXHJcbiAgKTtcclxufVxyXG4iLCJpbXBvcnQgXCIuL3BhZ2VzL2luZGV4LmNzc1wiO1xyXG5pbXBvcnQgeyBjcmVhdGVDYXJkLCBoYW5kbGVMaWtlQnV0dG9uQ2xpY2sgfSBmcm9tIFwiLi9zY3JpcHRzL2NhcmQuanNcIjtcclxuaW1wb3J0IHsgb3Blbk1vZGFsLCBjbG9zZU1vZGFsIH0gZnJvbSBcIi4vc2NyaXB0cy9tb2RhbC5qc1wiO1xyXG5pbXBvcnQgeyBlbmFibGVWYWxpZGF0aW9uLCBjbGVhclZhbGlkYXRpb24gfSBmcm9tIFwiLi9zY3JpcHRzL3ZhbGlkYXRpb24uanNcIjtcclxuaW1wb3J0IHtcclxuICBnZXRVc2VyUHJvZmlsZSxcclxuICBnZXRDYXJkTGlzdCxcclxuICBwYXRjaFVzZXJQcm9maWxlLFxyXG4gIHBvc3ROZXdDYXJkLFxyXG4gIHBhdGNoVXNlckF2YXRhcixcclxuICBkZWxldGVDYXJkLFxyXG4gIGlzSW1hZ2VVUkwsXHJcbn0gZnJvbSBcIi4vc2NyaXB0cy9hcGkuanNcIjtcclxuXHJcbmNvbnN0IHZhbGlkYXRpb25Db25maWcgPSB7XHJcbiAgZm9ybVNlbGVjdG9yOiBcIi5wb3B1cF9fZm9ybVwiLFxyXG4gIGlucHV0U2VsZWN0b3I6IFwiLnBvcHVwX19pbnB1dFwiLFxyXG4gIHN1Ym1pdEJ1dHRvblNlbGVjdG9yOiBcIi5wb3B1cF9fYnV0dG9uXCIsXHJcbiAgaW5hY3RpdmVCdXR0b25DbGFzczogXCJwb3B1cF9fYnV0dG9uX2lzLWluYWN0aXZlXCIsXHJcbiAgaW5wdXRFcnJvckNsYXNzOiBcInBvcHVwX19pbnB1dF90eXBlX2Vycm9yXCIsXHJcbiAgZXJyb3JDbGFzczogXCJwb3B1cF9faW5wdXQtZXJyb3JfaXMtYWN0aXZlXCIsXHJcbn07XHJcblxyXG5sZXQgY3VycmVudFVzZXJJZDtcclxuXHJcbmNvbnN0IGNhcmRzTGlzdENvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucGxhY2VzX19saXN0XCIpO1xyXG5jb25zdCBwb3B1cHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLnBvcHVwXCIpO1xyXG5cclxuY29uc3QgcHJvZmlsZUVkaXRQb3B1cCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfdHlwZV9lZGl0XCIpO1xyXG5jb25zdCBwcm9maWxlQXZhdGFyRWRpdFBvcHVwID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wb3B1cF90eXBlX2F2YXRhclwiKTtcclxuY29uc3QgcHJvZmlsZUVkaXRCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2VkaXQtYnV0dG9uXCIpO1xyXG5cclxuY29uc3QgY2FyZEFkZFBvcHVwID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wb3B1cF90eXBlX25ldy1jYXJkXCIpO1xyXG5jb25zdCBjYXJkQWRkQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19hZGQtYnV0dG9uXCIpO1xyXG5cclxuY29uc3QgaW1hZ2VQb3B1cCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfdHlwZV9pbWFnZVwiKTtcclxuY29uc3QgaW1hZ2VQb3B1cFBob3RvID0gaW1hZ2VQb3B1cC5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwX19pbWFnZVwiKTtcclxuY29uc3QgaW1hZ2VQb3B1cFBob3RvQ2FwdGlvbiA9IGltYWdlUG9wdXAucXVlcnlTZWxlY3RvcihcIi5wb3B1cF9fY2FwdGlvblwiKTtcclxuXHJcbmNvbnN0IHByb2ZpbGVUaXRsZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fdGl0bGVcIik7XHJcbmNvbnN0IHByb2ZpbGVEZXNjcmlwdGlvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fZGVzY3JpcHRpb25cIik7XHJcbmNvbnN0IHByb2ZpbGVJbWFnZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9faW1hZ2VcIik7XHJcblxyXG5jb25zdCBwcm9maWxlRWRpdEZvcm0gPSBkb2N1bWVudC5mb3Jtc1tcImVkaXQtcHJvZmlsZVwiXTtcclxuY29uc3QgcHJvZmlsZUVkaXROYW1lSW5wdXQgPSBwcm9maWxlRWRpdEZvcm0uZWxlbWVudHMubmFtZTtcclxuY29uc3QgcHJvZmlsZUVkaXREZXNjSW5wdXQgPSBwcm9maWxlRWRpdEZvcm0uZWxlbWVudHMuZGVzY3JpcHRpb247XHJcblxyXG5jb25zdCBwcm9maWxlQXZhdGFyRWRpdEZvcm0gPSBkb2N1bWVudC5mb3Jtc1tcImVkaXQtYXZhdGFyXCJdO1xyXG5jb25zdCBwcm9maWxlQXZhdGFyTGluayA9IHByb2ZpbGVBdmF0YXJFZGl0Rm9ybS5lbGVtZW50cy5saW5rO1xyXG5cclxuY29uc3QgY2FyZEFkZEZvcm0gPSBkb2N1bWVudC5mb3Jtc1tcIm5ldy1wbGFjZVwiXTtcclxuY29uc3QgbmV3Q2FyZE5hbWVJbnB1dCA9IGNhcmRBZGRGb3JtLmVsZW1lbnRzW1wicGxhY2UtbmFtZVwiXTtcclxuY29uc3QgbmV3Q2FyZExpbmtJbnB1dCA9IGNhcmRBZGRGb3JtLmVsZW1lbnRzW1wibGlua1wiXTtcclxuXHJcbmNvbnN0IGRlbGV0ZUNhcmRQb3B1cCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfdHlwZV9kZWxldGVcIik7XHJcbmNvbnN0IGNvbmZpcm1DYXJkRGVsZXRlQnV0dG9uID0gZGVsZXRlQ2FyZFBvcHVwLnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfX2J1dHRvblwiKTtcclxuY29uc3QgY2FyZFRvRGVsZXRlID0ge1xyXG4gIGNhcmRJZDogbnVsbCxcclxuICBjYXJkRWxlbWVudDogbnVsbCxcclxufTtcclxuXHJcbmZ1bmN0aW9uIHJlbmRlckxvYWRpbmcoaXNMb2FkaW5nLCBidXR0b25FbGVtZW50KSB7XHJcbiAgYnV0dG9uRWxlbWVudC50ZXh0Q29udGVudCA9IGlzTG9hZGluZyA/IFwi0KHQvtGF0YDQsNC90LXQvdC40LUuLi5cIiA6IFwi0KHQvtGF0YDQsNC90LjRgtGMXCI7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHJlbmRlclVzZXJQcm9maWxlKHByb2ZpbGVEYXRhKSB7XHJcbiAgcHJvZmlsZVRpdGxlLnRleHRDb250ZW50ID0gcHJvZmlsZURhdGEubmFtZTtcclxuICBwcm9maWxlRGVzY3JpcHRpb24udGV4dENvbnRlbnQgPSBwcm9maWxlRGF0YS5hYm91dDtcclxuICBwcm9maWxlSW1hZ2Uuc3R5bGUuYmFja2dyb3VuZEltYWdlID0gYHVybCgke3Byb2ZpbGVEYXRhLmF2YXRhcn0pYDtcclxufVxyXG5cclxuZnVuY3Rpb24gcmVuZGVyQ2FyZExpc3QoY2FyZExpc3QpIHtcclxuICBjYXJkTGlzdC5mb3JFYWNoKChjYXJkKSA9PiB7XHJcbiAgICBjYXJkc0xpc3RDb250YWluZXIuYXBwZW5kKFxyXG4gICAgICBjcmVhdGVDYXJkKFxyXG4gICAgICAgIGNhcmQsXHJcbiAgICAgICAgY3VycmVudFVzZXJJZCxcclxuICAgICAgICBoYW5kbGVDYXJkSW1hZ2VDbGljayxcclxuICAgICAgICBoYW5kbGVMaWtlQnV0dG9uQ2xpY2ssXHJcbiAgICAgICAgaGFuZGxlRGVsZXRlQnV0dG9uQ2xpY2tcclxuICAgICAgKVxyXG4gICAgKTtcclxuICB9KTtcclxufVxyXG5cclxuZnVuY3Rpb24gaW5pdEFwcChwcm9maWxlRGF0YVByb21pc2UsIGNhcmRMaXN0UHJvbWlzZSkge1xyXG4gIFByb21pc2UuYWxsKFtwcm9maWxlRGF0YVByb21pc2UsIGNhcmRMaXN0UHJvbWlzZV0pXHJcbiAgICAudGhlbigoW3Byb2ZpbGVEYXRhLCBjYXJkTGlzdF0pID0+IHtcclxuICAgICAgY3VycmVudFVzZXJJZCA9IHByb2ZpbGVEYXRhLl9pZDtcclxuICAgICAgcmVuZGVyVXNlclByb2ZpbGUocHJvZmlsZURhdGEpO1xyXG4gICAgICByZW5kZXJDYXJkTGlzdChjYXJkTGlzdCk7XHJcbiAgICB9KVxyXG4gICAgLmNhdGNoKChlcnIpID0+IGNvbnNvbGUubG9nKGVycikpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBwcmVwYXJlUHJvZmlsZUVkaXRGb3JtKHRpdGxlLCBkZXNjcmlwdGlvbikge1xyXG4gIGNsZWFyVmFsaWRhdGlvbihwcm9maWxlRWRpdEZvcm0sIHZhbGlkYXRpb25Db25maWcpO1xyXG4gIHByb2ZpbGVFZGl0TmFtZUlucHV0LnZhbHVlID0gdGl0bGU7XHJcbiAgcHJvZmlsZUVkaXREZXNjSW5wdXQudmFsdWUgPSBkZXNjcmlwdGlvbjtcclxufVxyXG5cclxuZnVuY3Rpb24gaGFuZGxlUHJvZmlsZUVkaXRGb3JtU3VibWl0KGV2dCkge1xyXG4gIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gIGNvbnN0IHN1Ym1pdEJ1dHRvbkVsZW1lbnQgPSBwcm9maWxlRWRpdEZvcm0ucXVlcnlTZWxlY3RvcihcIi5wb3B1cF9fYnV0dG9uXCIpO1xyXG4gIGNvbnN0IG5ld1Byb2ZpbGVEYXRhID0ge1xyXG4gICAgbmFtZTogcHJvZmlsZUVkaXROYW1lSW5wdXQudmFsdWUsXHJcbiAgICBhYm91dDogcHJvZmlsZUVkaXREZXNjSW5wdXQudmFsdWUsXHJcbiAgfTtcclxuICByZW5kZXJMb2FkaW5nKHRydWUsIHN1Ym1pdEJ1dHRvbkVsZW1lbnQpO1xyXG4gIHBhdGNoVXNlclByb2ZpbGUobmV3UHJvZmlsZURhdGEpXHJcbiAgICAudGhlbigocmVzKSA9PiB7XHJcbiAgICAgIHJlbmRlclVzZXJQcm9maWxlKHJlcyk7XHJcbiAgICAgIGNsb3NlTW9kYWwocHJvZmlsZUVkaXRQb3B1cCk7XHJcbiAgICB9KVxyXG4gICAgLmNhdGNoKChlcnIpID0+IGNvbnNvbGUubG9nKGVycikpXHJcbiAgICAuZmluYWxseSgoKSA9PiByZW5kZXJMb2FkaW5nKGZhbHNlLCBzdWJtaXRCdXR0b25FbGVtZW50KSk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGhhbmRsZUNhcmRBZGRGb3JtU3VibWl0KGV2dCkge1xyXG4gIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gIGNvbnN0IHN1Ym1pdEJ1dHRvbkVsZW1lbnQgPSBjYXJkQWRkRm9ybS5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwX19idXR0b25cIik7XHJcbiAgY29uc3QgbmV3Q2FyZCA9IHtcclxuICAgIG5hbWU6IG5ld0NhcmROYW1lSW5wdXQudmFsdWUsXHJcbiAgICBsaW5rOiBuZXdDYXJkTGlua0lucHV0LnZhbHVlLFxyXG4gIH07XHJcbiAgcmVuZGVyTG9hZGluZyh0cnVlLCBzdWJtaXRCdXR0b25FbGVtZW50KTtcclxuICBwb3N0TmV3Q2FyZChuZXdDYXJkKVxyXG4gICAgLnRoZW4oKHJlcykgPT4ge1xyXG4gICAgICBjYXJkc0xpc3RDb250YWluZXIucHJlcGVuZChcclxuICAgICAgICBjcmVhdGVDYXJkKFxyXG4gICAgICAgICAgcmVzLFxyXG4gICAgICAgICAgY3VycmVudFVzZXJJZCxcclxuICAgICAgICAgIGhhbmRsZUNhcmRJbWFnZUNsaWNrLFxyXG4gICAgICAgICAgaGFuZGxlTGlrZUJ1dHRvbkNsaWNrLFxyXG4gICAgICAgICAgaGFuZGxlRGVsZXRlQnV0dG9uQ2xpY2tcclxuICAgICAgICApXHJcbiAgICAgICk7XHJcbiAgICAgIGNsb3NlTW9kYWwoY2FyZEFkZFBvcHVwKTtcclxuICAgICAgY2xlYXJWYWxpZGF0aW9uKGNhcmRBZGRGb3JtLCB2YWxpZGF0aW9uQ29uZmlnKTtcclxuICAgIH0pXHJcbiAgICAuY2F0Y2goKGVycikgPT4gY29uc29sZS5sb2coZXJyKSlcclxuICAgIC5maW5hbGx5KCgpID0+IHJlbmRlckxvYWRpbmcoZmFsc2UsIHN1Ym1pdEJ1dHRvbkVsZW1lbnQpKTtcclxufVxyXG5cclxuZnVuY3Rpb24gaGFuZGxlQXZhdGFyQ2hhbmdlRm9ybVN1Ym1pdChldnQpIHtcclxuICBldnQucHJldmVudERlZmF1bHQoKTtcclxuICBjb25zdCBzdWJtaXRCdXR0b25FbGVtZW50ID1cclxuICAgIHByb2ZpbGVBdmF0YXJFZGl0Rm9ybS5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwX19idXR0b25cIik7XHJcbiAgcmVuZGVyTG9hZGluZyh0cnVlLCBzdWJtaXRCdXR0b25FbGVtZW50KTtcclxuICBwYXRjaFVzZXJBdmF0YXIocHJvZmlsZUF2YXRhckxpbmsudmFsdWUpXHJcbiAgICAudGhlbigocmVzKSA9PiB7XHJcbiAgICAgIHJlbmRlclVzZXJQcm9maWxlKHJlcyk7XHJcbiAgICAgIGNsb3NlTW9kYWwocHJvZmlsZUF2YXRhckVkaXRQb3B1cCk7XHJcbiAgICAgIHByb2ZpbGVBdmF0YXJFZGl0Rm9ybS5yZXNldCgpO1xyXG4gICAgfSlcclxuICAgIC5jYXRjaCgoZXJyKSA9PiBjb25zb2xlLmxvZyhlcnIpKVxyXG4gICAgLmZpbmFsbHkoKCkgPT4gcmVuZGVyTG9hZGluZyhmYWxzZSwgc3VibWl0QnV0dG9uRWxlbWVudCkpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBoYW5kbGVDYXJkSW1hZ2VDbGljayhldnQpIHtcclxuICBjb25zdCB0YXJnZXQgPSBldnQudGFyZ2V0O1xyXG4gIGNvbnN0IGNhcmQgPSB0YXJnZXQuY2xvc2VzdChcIi5jYXJkXCIpO1xyXG4gIGNvbnN0IGNhcmRUaXRsZSA9IGNhcmQucXVlcnlTZWxlY3RvcihcIi5jYXJkX190aXRsZVwiKTtcclxuICBvcGVuTW9kYWwoaW1hZ2VQb3B1cCk7XHJcbiAgaW1hZ2VQb3B1cFBob3RvLnNyYyA9IHRhcmdldC5zcmM7XHJcbiAgaW1hZ2VQb3B1cFBob3RvLmFsdCA9IHRhcmdldC5hbHQ7XHJcbiAgaW1hZ2VQb3B1cFBob3RvQ2FwdGlvbi50ZXh0Q29udGVudCA9IGNhcmRUaXRsZS50ZXh0Q29udGVudDtcclxufVxyXG5cclxuZnVuY3Rpb24gaGFuZGxlRGVsZXRlQnV0dG9uQ2xpY2soY2FyZElkLCBjYXJkRWxlbWVudCkge1xyXG4gIG9wZW5Nb2RhbChkZWxldGVDYXJkUG9wdXApO1xyXG4gIGNhcmRUb0RlbGV0ZS5jYXJkSWQgPSBjYXJkSWQ7XHJcbiAgY2FyZFRvRGVsZXRlLmNhcmRFbGVtZW50ID0gY2FyZEVsZW1lbnQ7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGhhbmRsZUNvbmZpcm1CdXR0b25DbGljayhjYXJkVG9EZWxldGUpIHtcclxuICBkZWJ1Z2dlcjtcclxuICBkZWxldGVDYXJkKGNhcmRUb0RlbGV0ZS5jYXJkSWQpXHJcbiAgICAudGhlbigoKSA9PiB7XHJcbiAgICAgIGNsb3NlTW9kYWwoZGVsZXRlQ2FyZFBvcHVwKTtcclxuICAgICAgY2FyZFRvRGVsZXRlLmNhcmRFbGVtZW50LnJlbW92ZSgpO1xyXG4gICAgfSlcclxuICAgIC5jYXRjaCgoZXJyKSA9PiBjb25zb2xlLmxvZyhlcnIpKTtcclxufVxyXG5cclxucHJvZmlsZUVkaXRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcclxuICBwcmVwYXJlUHJvZmlsZUVkaXRGb3JtKFxyXG4gICAgcHJvZmlsZVRpdGxlLnRleHRDb250ZW50LFxyXG4gICAgcHJvZmlsZURlc2NyaXB0aW9uLnRleHRDb250ZW50XHJcbiAgKTtcclxuICBvcGVuTW9kYWwocHJvZmlsZUVkaXRQb3B1cCk7XHJcbn0pO1xyXG5cclxucHJvZmlsZUltYWdlLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiBvcGVuTW9kYWwocHJvZmlsZUF2YXRhckVkaXRQb3B1cCkpO1xyXG5wcm9maWxlRWRpdEZvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCBoYW5kbGVQcm9maWxlRWRpdEZvcm1TdWJtaXQpO1xyXG5wcm9maWxlQXZhdGFyRWRpdEZvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCBoYW5kbGVBdmF0YXJDaGFuZ2VGb3JtU3VibWl0KTtcclxuXHJcbmNhcmRBZGRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IG9wZW5Nb2RhbChjYXJkQWRkUG9wdXApKTtcclxuY2FyZEFkZEZvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCBoYW5kbGVDYXJkQWRkRm9ybVN1Ym1pdCk7XHJcblxyXG5jb25maXJtQ2FyZERlbGV0ZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT5cclxuICBoYW5kbGVDb25maXJtQnV0dG9uQ2xpY2soY2FyZFRvRGVsZXRlKVxyXG4pO1xyXG5cclxucG9wdXBzLmZvckVhY2goKHBvcHVwKSA9PiB7XHJcbiAgcG9wdXAuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCAoZXZ0KSA9PiB7XHJcbiAgICBpZiAoXHJcbiAgICAgIGV2dC50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKFwicG9wdXBfX2Nsb3NlXCIpIHx8XHJcbiAgICAgIGV2dC50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKFwicG9wdXBfaXMtb3BlbmVkXCIpXHJcbiAgICApIHtcclxuICAgICAgY2xvc2VNb2RhbChwb3B1cCk7XHJcbiAgICB9XHJcbiAgfSk7XHJcbn0pO1xyXG5cclxuY29uc3QgdXNlclByb2ZpbGUgPSBnZXRVc2VyUHJvZmlsZSgpO1xyXG5jb25zdCBjYXJkTGlzdCA9IGdldENhcmRMaXN0KCk7XHJcbmluaXRBcHAodXNlclByb2ZpbGUsIGNhcmRMaXN0KTtcclxuZW5hYmxlVmFsaWRhdGlvbih2YWxpZGF0aW9uQ29uZmlnKTtcclxuXHJcbi8qIGlzSW1hZ2VVUkwoXHJcbiAgXCJodHRwczovL29waXMtY2RuLnRpbmtvZmZqb3VybmFsLnJ1L21lcmN1cnkvaXMtZ2lnYWNoYWQtcmVhbC0wNC5xaXdjaWJ0NWwxZW4uLmpwZ1wiXHJcbik7Ki9cclxuLyogaXNJbWFnZVVSTChcclxuICBcImh0dHBzOi8vZW5jcnlwdGVkLXRibjAuZ3N0YXRpYy5jb20vaW1hZ2VzP3E9dGJuOkFOZDlHY1N2cERoWHlMR0pVeVdBTGQ1S1JnS3ktanJySE1ncDBJd0lQcWhCQmNiNnpRJnNcIlxyXG4pLnRoZW4oKHJlcykgPT4gY29uc29sZS5sb2cocmVzKSk7ICovXHJcbiJdLCJuYW1lcyI6WyJhcGlDb25maWciLCJiYXNlVVJMIiwiaGVhZGVycyIsImF1dGhvcml6YXRpb24iLCJoYW5kbGVSZXNwb25zZSIsInJlc3BvbnNlIiwiZXJyb3JNZXNzYWdlIiwib2siLCJqc29uIiwiUHJvbWlzZSIsInJlamVjdCIsImNvbmNhdCIsInN0YXR1cyIsInB1dENhcmRMaWtlIiwiY2FyZElkIiwiZmV0Y2giLCJtZXRob2QiLCJ0aGVuIiwicmVzIiwiZGVsZXRlQ2FyZExpa2UiLCJjYXJkVGVtcGxhdGUiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJjb250ZW50IiwiY3JlYXRlQ2FyZCIsImNhcmQiLCJ1c2VySWQiLCJpbWFnZUNsaWNrSGFuZGxlciIsImxpa2VCdXR0b25DbGlja0hhbmRsZXIiLCJkZWxldGVCdXR0b25DbGlja0hhbmRsZXIiLCJjYXJkRWxlbWVudCIsImNsb25lTm9kZSIsImNhcmRJbWFnZSIsInNyYyIsImxpbmsiLCJhbHQiLCJuYW1lIiwiYWRkRXZlbnRMaXN0ZW5lciIsInRleHRDb250ZW50IiwibGlrZUJ1dHRvbiIsImxpa2VzQ291bnQiLCJyZW5kZXJMaWtlc0NvdW50IiwibGlrZXMiLCJsZW5ndGgiLCJldnQiLCJfaWQiLCJzb21lIiwibGlrZSIsImNsYXNzTGlzdCIsImFkZCIsImRlbGV0ZUJ1dHRvbiIsIm93bmVyIiwic3R5bGUiLCJkaXNwbGF5IiwiaGFuZGxlTGlrZUJ1dHRvbkNsaWNrIiwibGlrZXNDb3VudEVsZW1lbnQiLCJ0YXJnZXQiLCJjb250YWlucyIsInRvZ2dsZSIsImNhdGNoIiwiZXJyIiwiY29uc29sZSIsImxvZyIsIm9wZW5Nb2RhbCIsInBvcHVwRWxlbWVudCIsImNsb3NlUG9wdXBPbkVzY0tleWRvd24iLCJjbG9zZU1vZGFsIiwicmVtb3ZlIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsImtleSIsImhpZGVJbnB1dEVycm9yIiwiZm9ybUVsZW1lbnQiLCJpbnB1dEVsZW1lbnQiLCJ2YWxpZGF0aW9uQ29uZmlnIiwiZXJyb3JFbGVtZW50IiwiaWQiLCJpbnB1dEVycm9yQ2xhc3MiLCJlcnJvckNsYXNzIiwidG9nZ2xlQnV0dG9uU3RhdGUiLCJpbnB1dExpc3QiLCJidXR0b25FbGVtZW50IiwidmFsaWRpdHkiLCJ2YWxpZCIsImhhc0ludmFsaWRJbnB1dCIsImluYWN0aXZlQnV0dG9uQ2xhc3MiLCJkaXNhYmxlZCIsImNsZWFyVmFsaWRhdGlvbiIsIkFycmF5IiwiZnJvbSIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJpbnB1dFNlbGVjdG9yIiwic3VibWl0QnV0dG9uU2VsZWN0b3IiLCJyZXNldCIsImZvckVhY2giLCJjdXJyZW50VXNlcklkIiwicHJvZmlsZURhdGFQcm9taXNlIiwiY2FyZExpc3RQcm9taXNlIiwiZm9ybVNlbGVjdG9yIiwiY2FyZHNMaXN0Q29udGFpbmVyIiwicG9wdXBzIiwicHJvZmlsZUVkaXRQb3B1cCIsInByb2ZpbGVBdmF0YXJFZGl0UG9wdXAiLCJwcm9maWxlRWRpdEJ1dHRvbiIsImNhcmRBZGRQb3B1cCIsImNhcmRBZGRCdXR0b24iLCJpbWFnZVBvcHVwIiwiaW1hZ2VQb3B1cFBob3RvIiwiaW1hZ2VQb3B1cFBob3RvQ2FwdGlvbiIsInByb2ZpbGVUaXRsZSIsInByb2ZpbGVEZXNjcmlwdGlvbiIsInByb2ZpbGVJbWFnZSIsInByb2ZpbGVFZGl0Rm9ybSIsImZvcm1zIiwicHJvZmlsZUVkaXROYW1lSW5wdXQiLCJlbGVtZW50cyIsInByb2ZpbGVFZGl0RGVzY0lucHV0IiwiZGVzY3JpcHRpb24iLCJwcm9maWxlQXZhdGFyRWRpdEZvcm0iLCJwcm9maWxlQXZhdGFyTGluayIsImNhcmRBZGRGb3JtIiwibmV3Q2FyZE5hbWVJbnB1dCIsIm5ld0NhcmRMaW5rSW5wdXQiLCJkZWxldGVDYXJkUG9wdXAiLCJjb25maXJtQ2FyZERlbGV0ZUJ1dHRvbiIsImNhcmRUb0RlbGV0ZSIsInJlbmRlckxvYWRpbmciLCJpc0xvYWRpbmciLCJyZW5kZXJVc2VyUHJvZmlsZSIsInByb2ZpbGVEYXRhIiwiYWJvdXQiLCJiYWNrZ3JvdW5kSW1hZ2UiLCJhdmF0YXIiLCJoYW5kbGVDYXJkSW1hZ2VDbGljayIsImNhcmRUaXRsZSIsImNsb3Nlc3QiLCJoYW5kbGVEZWxldGVCdXR0b25DbGljayIsInRpdGxlIiwidmFsdWUiLCJwcmV2ZW50RGVmYXVsdCIsInN1Ym1pdEJ1dHRvbkVsZW1lbnQiLCJuZXdQcm9maWxlRGF0YSIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5IiwiZmluYWxseSIsImF2YXRhclVSTCIsIm5ld0NhcmQiLCJwcmVwZW5kIiwiaGFuZGxlQ29uZmlybUJ1dHRvbkNsaWNrIiwicG9wdXAiLCJhbGwiLCJfcmVmIiwiX3JlZjIiLCJjYXJkTGlzdCIsImFwcGVuZCIsInJlbmRlckNhcmRMaXN0IiwicGF0dGVybk1pc21hdGNoIiwic2V0Q3VzdG9tVmFsaWRpdHkiLCJkYXRhc2V0Iiwic2hvd0lucHV0RXJyb3IiLCJ2YWxpZGF0aW9uTWVzc2FnZSIsImNoZWNrSW5wdXRWYWxpZGl0eSIsInNldEV2ZW50TGlzdGVuZXJzIiwiZW5hYmxlVmFsaWRhdGlvbiJdLCJzb3VyY2VSb290IjoiIn0=